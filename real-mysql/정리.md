# 📖 Real MySQL 8.0 1권

<div align = "center">
   <a href="https://www.yes24.com/Product/Goods/102819435">
<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230621184411106.png" alt="image-20230621184411106"  style="width:200px;"/>
  </a>
</div>

<br>

**MySQL의 사용법과 원리에 대한 깊은 이해를 하고 싶어서 읽기 시작했습니다.**



<details>

<summary><h3> Mysql 명령어 </h3></summary>



### 📌 cmd에서 접속

```
cmd> mysql -uroot -p //입력 후 패스워드 입력
```

<br>

### 📌 버전 확인

```sql
mysql> SELECT VERSION();
```

<br>

### 📌 데이터 베이스 확인

```sql
mysql> SHOW DATABASES;
```

<br>

### 📌 시스템 변수

```sql
SHOW GLOBAL VARIABLES; -- 시스템 변수 조회

SET 시스템변수=값 -- 시스템 변수 값 동적 변경 (GLOBAL 붙일 시 글로벌 변수에 적용)

SET PERSIST 시스템변수=값 -- 글로벌 변수 변경 및 설정 파일 반영

SET PERSIST_ONLY 시스템변수=값 -- 설정 파일에만 변경사항 적용

RESET PERSIST 시스템변수 -- SET PERSIST로 변경했던 사항 삭제, 현재 서버에는 적용되지 않음

```

<br>

### 📌 설정 파일 위치 및 순서 확인

MySQL은 단 하나의 설정 파일을 사용한다. 리눅스 혹은 유닉스의 경우 `my.cnf` 윈도우 계열은 `my.ini` 를 사용한다.

MySQL 서버는 지정된 여러 개의 디렉터리를 순차적으로 탐색하면서 처음 발견된 `my.cnf` 파일을 사용한다.

<br>

```
cmd> mysql --help // cmd 창에서 입력
```

위 명령어를 입력하면



```
Default options are read from the following files in the given order:
C:\WINDOWS\my.ini C:\WINDOWS\my.cnf C:\my.ini C:\my.cnf C:\Program Files\MySQL\MySQL Server 8.0\my.ini C:\Program Files\MySQL\MySQL Server 8.0\my.cnf
```

위와 같은 내용을 확인할 수 있다.

내 컴퓨터의 경우 `C:\WINDOWS\my.ini` 를 제일 우선적으로 참조한다.

<br>

### 📌 8.0 업그레이드 시 변경 사항 체크

```sql
-- mysqlcheck을 이용한 손상되거나 호환되지 않는 파일 확인
cmd> mysqlcheck -u root -p --all-databases --check-upgrade

-- 외래키 이름 길이 체크
mysql> SELECT TABLE_SCHEMA, TABLE_NAME FROM information_schema.TABLES WHERE TABLE_NAME IN  
(SELECT LEFT(SUBSTR(ID,INSTR(ID,'/')+1),INSTR(SUBSTR(ID,INSTR(ID,'/')+1),'_ibfk_')-1) 
FROM information_schema.INNODB_SYS_FOREIGN
WHERE LENGTH(SUBSTR(ID,INSTR(ID,'/')+1))> 64);

-- 공용 테이블 스페이스에 저장된 파티션이 있는지 체크
mysql> SELECT DISTINCT NAME, SPACE, SPACE_TYPE FROM information_schema.INNODB_SYS_TABLES
WHERE NAME LIKE '%#P#%' AND SPACE_TYPE NOT LIKE '%Single%';
```

<br>

### 📌 기본 인증 방식을 Native Authentication 으로 변경

```sql
SET GLOBAL default_authentication_plugin="mysql_native_password"
```

<br>

### 📌 비밀번호 변경 및 2중 비밀번호 설정

```sql
-- 비밀번호 변경
mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password';

-- 기존 비밀번호를 세컨더리 비밀번호로 설정하고 변경
mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password' RETAIN CURRENT PASSWORD;

-- 세컨더리 비밀번호 삭제
mysql> ALTER USER 'root'@'localhost' DISCARD OLD PASSWORD;


```

<br>

### 📌 권한 부여

```sql
GRANT 권한 ON 스키마.테이블 TO 'user'@'localhost'
```


</details>


<details>

<summary><h3> MySQL 버전 업그레이드 8.0 변경 사항</h3></summary>



1️⃣ 사용자 인증 방식 변경

Caching SHA-2 Authentication 인증 방식이 기본 인증 방식으로 바뀌었다.

단, MySQL 5.7에 존재했던 계정은 여전히 Native Authentication 인증 방식을 사용한다.

만약 Native Authentication을 계속 사용하고자 한다면, MySQL 서버를 시작할 때

```
--default-authentication-plugin=mysql_native_password
```

위 파라미터를 활성화 해야한다.

<br>

2️⃣ 외래키 이름의 길이

MySQL 8.0 에서는 외래키 이름이 64글자로 제한된다.

<br>

3️⃣ 인덱스 힌트

이전 버전에서 사용되던 인덱스 힌트가 있다면 성능 테스트를 수행해야한다. 8.0 부터는 성능 저하를 유발할 수 있기 때문이다.

<br>

그 외, 호환되지 않은 파일 혹은 파티션의 각 테이블 스페이스를 공용 테이블 스페이스에 저장 불가



> 📌 **업그레이드 제약 사항**
>
>  **동일 메이저 버전**에서 **마이너 버전 간 업그레이드**는 데이터 파일 변경 없이 진행되며, **여러 버전을 건너뛰어서 업그레이드하는 것도 허용**.
>
> 단, **메이저 버전 간** 업그레이드는 반드시 🚨 **직전 버전에서만 업그레이드 허용**



</details>

<details>

<summary><h3> 글로벌 변수와 세션 변수</h3></summary>

MySQL 서버는 설정 파일(ex.`my.cnf`)의 내용을 읽어 메모리나 작동 방식을 초기화하고, 접속된 사용자를 제어하기 위해 값을 별도로 저장해둔다.

이러한 값을 **시스템 변수** 라고 한다.

시스템 변수는 적용 범위에 따라 글로벌 변수와 세션 변수로 나뉘고, 동시에 존재하는 경우는 `Var Scope` 가 `Both` 이다.

<br>

**글로벌 변수**는 하나의 MySQL 서버 인스턴스에서 전체적으로 영향을 미치는 시스템 변수를 의미한다.

예로, MySQL 서버에서 단 하나만 존재하는 InnoDB 버퍼 풀 크기(innodb_buffer_pool_size)가 있다.

<br>

**세션 변수**는 클라이언트가 서버에 접속할 때 기본으로 부여하는 옵션의 기본값을 제어하는 데 사용된다.

기본값은 글로벌 변수이며, 각 클라이언트가 설정하는 값은 세션 변수가 된다.

예로, 쿼리 단위로 자동 커밋을 수행할지 여부를 결정하는 `autocommit` 변수가 있다.

</details>


<details>

<summary><h3> 동적 변수와 정적 변수</h3></summary>

서버가 기동 중인 상태에서 변경 가능하면 동적 변수, 불가능하면 정적 변수이다.

기본적으로는 설정 파일을 바탕으로 시스템 변수가 정해지지만, 서버를 재시작하지 않고도 `SET` 명령어로 변수 값을 변경할 수 있다.

다만, 이렇게 변경된 값은 기동 중인 인스턴스에서만 반영되고 설정 파일 내용은 바뀌지 않는다.

<br>

💡 MySQL 8.0 부터는 `SET PERSIST` 명령을 이용하면 **실행 중인 서버의 변수를 변경하면서 설정 파일로도 기록**된다고 한다.

만약, **현재 서버에는 적용하지 않고 설정 파일에만 적용**하고 싶다면, `SET PERSIST_ONLY` 명령어를 사용하면 된다.

단, `SET PERSIST` 는 글로벌 변수에만 적용된다.

<br>

`SET GLOBAL 변수명=값`  과 같이 입력하면 글로벌 변수를 변경하고 `GLOBAL` 을 생략하면 세션 변수를 조회하고 변경한다.

</details>

<details>

<summary><h3> 사용자 및 권한 </h3></summary>

<details>

<summary><h4> 📌 계정 생성</h4></summary>

시스템 계정은 데이터베이스 서버 관리자를 위한 계정이다.

계정 관리 · 다른 세션 또는 그 세션에서 실행 중인 쿼리 강제 종료 · 스토어드 프로그램 생성 시 DEFINER를 타 사용자로 설정을 할 수 있다.

MySQL 5.7 버전 까지는 `GRANT` 명령으로 권한의 부여와 동시에 계정 생성이 가능했다.

하지만, 8.0 버전 부터는 **`CREATE USER` 명령으로 생성하고, `GRANT` 명령은 권한 부여 역할로 구분해서 실행하도록 바뀌었다.**

<br>

계정을 생성하는 예시는 다음과 같다.

```sql
CREATE USER 'user'@'%'
IDENTIFIED WITH 'mysql_native_password' BY 'password'
REQUIRE NONE
PASSWORD EXPIRE INTERVAL 30 DAY
ACCOUNT UNLOCK
PASSWORD HISOTRY DEFAULT 
PASSWORD REUSE INTERVAL DEFAULT
PASSWORD REQUIRE CURRENT DEFAULT;
```

<br>

1️⃣ IDENTIFIED WITH

사용자의 인증 방식과 비밀번호를 설정한다.

`mysql_native_password` 인증 방식은 5.7 버전까지 기본으로 사용되던 방식이다.

8.0 부터는 `caching_sha2_password` 방식이 기본 인증 방식이지만, 이 인증 방식을 사용하기 위해서는 SSL/TLS 또는 RSA 키페어를 반드시 사용해야한다.

따라서 클라이언트에서 접속할 때 SSL 옵션을 활성화해야한다.

<br>

2️⃣ REQUIRE

SSL/TLS 채널을 사용할지 여부를 설정

<br>

3️⃣ PASSWORD EXPIRE

비밀번호의 유효 기간을 설정하는 옵션이다.

별도로 명시하지 않으면 `default_password_lifetime` 변수에 저장된 값으로 설정된다.

`NEVER` , `INTERVAL n DAY`(유효기간을 오늘부터 n일자로) 등 옵션이 있다.

<br>

4️⃣ PASSWORD HISTORY

한 번 사용했던 비밀번호를 사용하지 못하게 하는 설정이다.

`password_history` 시스템 변수에 저장된 개수만큼 이력을 저장한다.

`PASSWORD HISTORY n` 과 같은 방식으로 개수를 지정할 수 있다.

<br>

5️⃣ PASSWORD REUSE INTERVAL

한 번 사용했던 비밀번호 재사용 금지 기간을 설정하는 옵션이다.

<br>

6️⃣ PASSWORD REQUIRE

비밀번호가 만료되어 새로운 비밀번호로 변경할 때, 현재 비밀번호를 필요로 할지 말지를 결정하는 옵션이다.

<br>

7️⃣ ACCOUNT LOCK / UNLOCK

계정 생성 시 또는 `ALTER USER` 명령을 사용해 **계정 정보를 변경할 때** 계정을 사용하지 못하게 잠글지 여부를 결정




</details>


</details>